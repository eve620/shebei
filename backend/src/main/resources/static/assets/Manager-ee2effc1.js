import{_ as j,g as i,o as z,h as r,b as k,c as C,i as a,j as u,w as M,k as N,d as A,F as H,m as p,s as S,B as T}from"./index-03f9d86f.js";import{g as $}from"./Instance-e9cab15d.js";import{O as G,d as K,D as Q}from"./exportToExcel-9b58f540.js";const W={class:"loading"},X={key:0},Y=["onClick"],Z={__name:"Manager",setup(ee){const d=$();let g;const l=i({}),w=i(!1),f=i(!1),U=()=>{l.value={},f.value=!0},y=t=>{n.value=!1,d.getManagerList(t).then(e=>{v.value=e.data.data,n.value=!0})},c=i(),F=()=>{c.value.validateFields().then(t=>{n.value=!1,d.addManager(l.value).then(e=>{e.data.code===1?(p.info(e.data.data),d.getManagerList().then(s=>{v.value=s.data.data,n.value=!0})):(p.info(e.data.msg),n.value=!0)}),f.value=!1}).catch(t=>{console.log("Validate Failed:",t)})},O=()=>{c.value.resetFields(),f.value=!1},_=i(!1),B=t=>{l.value=JSON.parse(JSON.stringify(t)),_.value=!0},E=()=>{c.value.validateFields().then(t=>{n.value=!1,d.editUser(l.value).then(e=>{e.data.code===1?(p.info(e.data.data),d.getManagerList().then(s=>{v.value=s.data.data,n.value=!0})):(p.info(e.data.msg),n.value=!0)}),_.value=!1}).catch(t=>{console.log("Validate Failed:",t)})},V=()=>{c.value.resetFields(),_.value=!1},q=t=>{n.value=!1,d.deleteUserById(t).then(e=>{e.data.code===1?(p.info(e.data.data),d.getManagerList().then(s=>{v.value=s.data.data,n.value=!0})):(p.info(e.data.msg),n.value=!0)})};z(()=>{d.whoami().then(t=>{t.data.code===1&&(g=t.data.data,w.value=g.roleId)}),d.getManagerList().then(t=>{v.value=t.data.data,n.value=!0})});const D=()=>{K("/user",v.value,"管理员表.xlsx")},v=i(),n=i(!1),L=[{title:"账号",dataIndex:"userAccount",width:"15%"},{title:"用户名",dataIndex:"userName",width:"15%"},{title:"权限",dataIndex:"roleId",width:"40%",customRender(t){return t.value===1?"管理员":"教师"}},{title:"操作",dataIndex:"operation"}];return(t,e)=>{const s=r("a-input"),m=r("a-form-item"),h=r("a-form"),b=r("a-modal"),R=r("a-spin"),x=r("a-radio-button"),P=r("a-radio-group"),J=r("a-table");return k(),C(H,null,[a(b,{open:f.value,"onUpdate:open":e[3]||(e[3]=o=>f.value=o),"ok-text":"确定","cancel-text":"取消",onOk:F,onCancel:O,title:"添加"},{default:u(()=>[a(h,{ref_key:"formRef",ref:c,model:l.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[a(m,{name:"userAccount",label:"账号",rules:[{required:!0,message:"请输入账号"}]},{default:u(()=>[a(s,{value:l.value.userAccount,"onUpdate:value":e[0]||(e[0]=o=>l.value.userAccount=o),placeholder:"请输入账号"},null,8,["value"])]),_:1}),a(m,{name:"userName",label:"用户名",rules:[{required:!0,message:"请输入用户名"}]},{default:u(()=>[a(s,{value:l.value.userName,"onUpdate:value":e[1]||(e[1]=o=>l.value.userName=o),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),a(m,{name:"userPassword",label:"密码",rules:[{required:!0,message:"密码最低6位",min:6}]},{default:u(()=>[a(s,{value:l.value.userPassword,"onUpdate:value":e[2]||(e[2]=o=>l.value.userPassword=o),placeHolder:"请输入密码"},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),a(G,{addShow:w.value,onAdd:U,onExport:D,onSearch:y},null,8,["addShow"]),M(A("div",W,[a(R,{size:"large"})],512),[[N,!n.value]]),a(b,{open:_.value,"onUpdate:open":e[7]||(e[7]=o=>_.value=o),"ok-text":"确定","cancel-text":"取消",onOk:E,onCancel:V,title:"编辑"},{default:u(()=>[a(h,{ref_key:"formRef",ref:c,model:l.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[a(m,{name:"userAccount",label:"账号",rules:[{required:!0,message:"请输入账号"}]},{default:u(()=>[a(s,{value:l.value.userAccount,"onUpdate:value":e[4]||(e[4]=o=>l.value.userAccount=o),placeholder:"请输入账号"},null,8,["value"])]),_:1}),a(m,{name:"userName",label:"用户名",rules:[{required:!0,message:"请输入用户名"}]},{default:u(()=>[a(s,{value:l.value.userName,"onUpdate:value":e[5]||(e[5]=o=>l.value.userName=o),placeholder:"请输入用户名"},null,8,["value"])]),_:1}),a(m,{label:"权限"},{default:u(()=>[a(P,{value:l.value.roleId,"onUpdate:value":e[6]||(e[6]=o=>l.value.roleId=o)},{default:u(()=>[a(x,{value:1},{default:u(()=>[S("管理员")]),_:1}),a(x,{value:0},{default:u(()=>[S("教师")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),M(a(J,{columns:L,"data-source":v.value,"row-key":"itemId",bordered:""},{bodyCell:u(({column:o,record:I})=>[o.dataIndex==="operation"?(k(),C("span",X,[A("a",{onClick:ae=>B(I)},"编辑",8,Y),a(Q,{onDelete:q,tagetId:I.userId},null,8,["tagetId"])])):T("",!0)]),_:1},8,["data-source"]),[[N,n.value]])],64)}}},ne=j(Z,[["__scopeId","data-v-be51bc46"]]);export{ne as default};
