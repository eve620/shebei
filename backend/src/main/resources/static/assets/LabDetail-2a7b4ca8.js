import{_ as Q,g,o as G,h as f,b as m,c as _,d as S,i as a,q as I,r as B,F as P,l as T,t as D,p as K,f as W,u as _e,C as be,z as R,A as H,j as u,w as $,k as V,m as U,s as c,D as ge,B as ye,x as z}from"./index-03f9d86f.js";import{g as X}from"./Instance-e9cab15d.js";import{O as he,d as Ne,D as we}from"./exportToExcel-9b58f540.js";import{d as xe}from"./utils-eab88610.js";const Ie=y=>(K("data-v-bd5f8a38"),y=y(),W(),y),Se=Ie(()=>S("span",{style:{color:"#707070"}},"返回",-1)),ke={key:0,class:"list-content"},Le=["onClick"],Ce={key:1},Ue={__name:"LabCheck",props:["labName"],setup(y){let q;const F=g(!1),s=X(),r=g([]),E=v=>{const b=B.currentRoute.value.path,l={...B.currentRoute.value.query};l.year=v,B.push({path:b,query:l})};return G(()=>{s.whoami().then(v=>{v.data.code===1&&(q=v.data.data,F.value=q.roleId)}),s.getYearList().then(v=>{r.value=v.data.data})}),(v,b)=>{const l=f("LeftOutlined"),A=f("a-empty");return m(),_("div",null,[S("div",{style:{cursor:"pointer"},onClick:b[0]||(b[0]=()=>{I(B).push("/home/lab")})},[a(l,{style:{padding:"0 5px 15px 0","font-size":"15px",color:"#707070","margin-left":"10px"}}),Se]),r.value.length?(m(),_("div",ke,[(m(!0),_(P,null,T(r.value,h=>(m(),_("div",{class:"list-button",onClick:N=>E(h),key:h.id},D(h+"审查"),9,Le))),128))])):(m(),_("div",Ce,[a(A,{description:"暂无数据"})]))])}}},qe=Q(Ue,[["__scopeId","data-v-bd5f8a38"]]);const Ae=y=>(K("data-v-e0887ff5"),y=y(),W(),y),Oe={key:0},Re={style:{display:"flex","justify-content":"space-between",padding:"0 10px"}},De=Ae(()=>S("span",{style:{color:"#707070"}},"返回",-1)),Ee={style:{color:"#707070","font-weight":"bold"}},Be={class:"loading"},Pe={key:0},Te=["onClick"],Fe={key:1},Me={__name:"LabDetail",setup(y){const q=_e(),F=be(),s=xe(q.query.id),r=X();let E,v,b;const l=g({}),A=g(!1),h=g(!1),N=R(()=>q.query.year);H(N,(o,e)=>{console.log(s),console.log(o)});const Z=async()=>{if(l.value={labName:s},v===void 0||b===void 0){const o=await r.getAllUserList(),e=await r.getAllLabList();v=o.data.data,b=e.data.data}h.value=!0},C=g(),ee=()=>{C.value.validateFields().then(o=>{i.value=!1,r.addItem(l.value).then(e=>{e.data.code===1?(U.info(e.data.data),r.getItemList(N,s).then(d=>{x.value=d.data.data,w.value=d.data.data,i.value=!0})):(U.info(e.data.msg),i.value=!0)}),h.value=!1}).catch(o=>{console.log("Validate Failed:",o)})},ae=()=>{C.value.resetFields(),h.value=!1},O=g(!1),te=async o=>{if(l.value=JSON.parse(JSON.stringify(o)),v===void 0||b===void 0){const e=await r.getAllUserList(),d=await r.getAllLabList();v=e.data.data,b=d.data.data}O.value=!0},le=()=>{C.value.validateFields().then(o=>{i.value=!1,r.editItem(l.value).then(e=>{e.data.code===1?(U.info(e.data.data),r.getItemList(N,s).then(d=>{x.value=d.data.data,w.value=d.data.data,i.value=!0})):(U.info(e.data.msg),i.value=!0)}),O.value=!1}).catch(o=>{console.log("Validate Failed:",o)})},ue=()=>{C.value.resetFields(),O.value=!1},oe=o=>{i.value=!1,r.deleteItemById(o).then(e=>{e.data.code===1?(U.info(e.data.data),r.getItemList(N,s).then(d=>{x.value=d.data.data,w.value=d.data.data,i.value=!0})):U.info(e.data.msg)})};H(N,(o,e)=>{o&&(i.value=!1,r.getItemList(o,s).then(d=>{x.value=d.data.data,w.value=d.data.data,i.value=!0}))}),G(()=>{r.whoami().then(o=>{o.data.code===1&&(E=o.data.data,A.value=E.roleId)}),N&&s&&r.getItemList(N,s).then(o=>{x.value=o.data.data,w.value=o.data.data,i.value=!0})});const de=()=>{Ne("/item",w.value,s+"资产详情表.xlsx")},w=g([]),x=g([]),i=g(!1),ne=R(()=>new Set(x.value.map(o=>o.itemName))),se=R(()=>{let o=[];return ne.value.forEach(e=>{o.push({value:e})}),o}),re=R(()=>new Set(x.value.map(o=>o.userName))),ie=R(()=>{let o=[];return re.value.forEach(e=>{o.push({value:e})}),o}),ve=o=>{i.value=!1,w.value=x.value.filter(e=>{const d=o.itemSelected,k=o.userSelected,n=d.length===0||d.some(L=>e.itemName.includes(L)),p=k.length===0||k.some(L=>e.userName.includes(L));return n&&p}),i.value=!0},me=[{title:"类型",dataIndex:"itemType",width:"10%"},{title:"编号",dataIndex:"itemNumber",width:"10%"},{title:"名称",dataIndex:"itemName",width:"15%"},{title:"型号",dataIndex:"itemModel",width:"15%"},{title:"价值",dataIndex:"itemPrice",width:"10%"},{title:"领用人",dataIndex:"userName",width:"10%"},{title:"存放实验室",dataIndex:"labName",width:"10%"},{title:"状态",dataIndex:"itemStatus",width:"8%"},{title:"操作",dataIndex:"operation"}];return(o,e)=>{const d=f("a-radio-button"),k=f("a-radio-group"),n=f("a-form-item"),p=f("a-input"),L=f("a-select-option"),M=f("a-select"),j=f("a-form"),J=f("a-modal"),pe=f("LeftOutlined"),ce=f("a-spin"),fe=f("a-table");return N.value?(m(),_("div",Oe,[a(J,{open:h.value,"onUpdate:open":e[9]||(e[9]=t=>h.value=t),"ok-text":"确定","cancel-text":"取消",onOk:ee,onCancel:ae,title:"添加"},{default:u(()=>[a(j,{ref_key:"formRef",ref:C,model:l.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[a(n,{name:"itemType",label:"资产类型",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(k,{value:l.value.itemType,"onUpdate:value":e[0]||(e[0]=t=>l.value.itemType=t)},{default:u(()=>[a(d,{value:"仪器设备"},{default:u(()=>[c("仪器设备")]),_:1}),a(d,{value:"低值设备"},{default:u(()=>[c("低值设备")]),_:1}),a(d,{value:"家具"},{default:u(()=>[c("家具")]),_:1})]),_:1},8,["value"])]),_:1}),a(n,{label:"资产编号"},{default:u(()=>[a(p,{value:l.value.itemNumber,"onUpdate:value":e[1]||(e[1]=t=>l.value.itemNumber=t),placeholder:"请输入资产编号"},null,8,["value"])]),_:1}),a(n,{name:"itemName",label:"资产名称",rules:[{required:!0,message:"请输入资产名称"}]},{default:u(()=>[a(p,{value:l.value.itemName,"onUpdate:value":e[2]||(e[2]=t=>l.value.itemName=t),placeholder:"请输入资产名称"},null,8,["value"])]),_:1}),a(n,{label:"型号"},{default:u(()=>[a(p,{value:l.value.itemModel,"onUpdate:value":e[3]||(e[3]=t=>l.value.itemModel=t),placeholder:"请输入型号"},null,8,["value"])]),_:1}),a(n,{name:"itemPrice",label:"价值",rules:[{required:!0,message:"请输入价值"}]},{default:u(()=>[a(p,{value:l.value.itemPrice,"onUpdate:value":e[4]||(e[4]=t=>l.value.itemPrice=t),placeholder:"请输入价值"},null,8,["value"])]),_:1}),a(n,{label:"净值"},{default:u(()=>[a(p,{value:l.value.itemNetworth,"onUpdate:value":e[5]||(e[5]=t=>l.value.itemNetworth=t),placeholder:"请输入净值"},null,8,["value"])]),_:1}),a(n,{name:"userName",label:"领用人",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(M,{value:l.value.userName,"onUpdate:value":e[6]||(e[6]=t=>l.value.userName=t),placeholder:"请选择"},{default:u(()=>[(m(!0),_(P,null,T(I(v),t=>(m(),z(L,{value:t.userName},{default:u(()=>[c(D(t.userName),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(n,{label:"实验室"},{default:u(()=>[a(p,{value:I(s),"onUpdate:value":e[7]||(e[7]=t=>ge(s)?s.value=t:null),disabled:!0},null,8,["value"])]),_:1}),a(n,{name:"itemStatus",label:"状态",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(k,{value:l.value.itemStatus,"onUpdate:value":e[8]||(e[8]=t=>l.value.itemStatus=t)},{default:u(()=>[a(d,{value:"在用"},{default:u(()=>[c("在用")]),_:1}),a(d,{value:"停用"},{default:u(()=>[c("停用")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),S("div",Re,[S("div",{style:{cursor:"pointer"},onClick:e[10]||(e[10]=()=>{I(F).back()})},[a(pe,{style:{padding:"0 5px 15px 0","font-size":"15px",color:"#707070"}}),De]),S("span",Ee,D(I(s)),1)]),a(he,{addShow:A.value,"item-list":se.value,"user-list":ie.value,onAdd:Z,onExport:de,onHandleSearch:ve},null,8,["addShow","item-list","user-list"]),$(S("div",Be,[a(ce,{size:"large"})],512),[[V,!i.value]]),a(J,{open:O.value,"onUpdate:open":e[20]||(e[20]=t=>O.value=t),"ok-text":"确定","cancel-text":"取消",onOk:le,onCancel:ue,title:"编辑"},{default:u(()=>[a(j,{ref_key:"formRef",ref:C,model:l.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[a(n,{name:"itemType",label:"资产类型",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(k,{value:l.value.itemType,"onUpdate:value":e[11]||(e[11]=t=>l.value.itemType=t)},{default:u(()=>[a(d,{value:"仪器设备"},{default:u(()=>[c("仪器设备")]),_:1}),a(d,{value:"低值设备"},{default:u(()=>[c("低值设备")]),_:1}),a(d,{value:"家具"},{default:u(()=>[c("家具")]),_:1})]),_:1},8,["value"])]),_:1}),a(n,{label:"资产编号"},{default:u(()=>[a(p,{value:l.value.itemNumber,"onUpdate:value":e[12]||(e[12]=t=>l.value.itemNumber=t),placeholder:"请输入资产编号"},null,8,["value"])]),_:1}),a(n,{name:"itemName",label:"资产名称",rules:[{required:!0,message:"请输入资产名称"}]},{default:u(()=>[a(p,{value:l.value.itemName,"onUpdate:value":e[13]||(e[13]=t=>l.value.itemName=t),placeholder:"请输入资产名称"},null,8,["value"])]),_:1}),a(n,{label:"型号"},{default:u(()=>[a(p,{value:l.value.itemModel,"onUpdate:value":e[14]||(e[14]=t=>l.value.itemModel=t),placeholder:"请输入型号"},null,8,["value"])]),_:1}),a(n,{name:"itemPrice",label:"价值",rules:[{required:!0,message:"请输入价值"}]},{default:u(()=>[a(p,{value:l.value.itemPrice,"onUpdate:value":e[15]||(e[15]=t=>l.value.itemPrice=t),placeholder:"请输入价值"},null,8,["value"])]),_:1}),a(n,{label:"净值"},{default:u(()=>[a(p,{value:l.value.itemNetworth,"onUpdate:value":e[16]||(e[16]=t=>l.value.itemNetworth=t),placeholder:"请输入净值"},null,8,["value"])]),_:1}),a(n,{name:"userName",label:"领用人",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(M,{value:l.value.userName,"onUpdate:value":e[17]||(e[17]=t=>l.value.userName=t),placeholder:"请选择"},{default:u(()=>[(m(!0),_(P,null,T(I(v),t=>(m(),z(L,{value:t.userName},{default:u(()=>[c(D(t.userName),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(n,{label:"实验室"},{default:u(()=>[a(M,{value:l.value.labName,"onUpdate:value":e[18]||(e[18]=t=>l.value.labName=t),placeholder:"请选择"},{default:u(()=>[(m(!0),_(P,null,T(I(b),t=>(m(),z(L,{value:t},{default:u(()=>[c(D(t),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(n,{name:"itemStatus",label:"状态",rules:[{required:!0,message:"请选择"}]},{default:u(()=>[a(k,{value:l.value.itemStatus,"onUpdate:value":e[19]||(e[19]=t=>l.value.itemStatus=t)},{default:u(()=>[a(d,{value:"在用"},{default:u(()=>[c("在用")]),_:1}),a(d,{value:"停用"},{default:u(()=>[c("停用")]),_:1})]),_:1},8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),$(a(fe,{columns:me,"data-source":w.value,"row-key":"itemId",bordered:""},{bodyCell:u(({column:t,record:Y})=>[t.dataIndex==="operation"?(m(),_("span",Pe,[S("a",{onClick:$e=>te(Y)},"编辑",8,Te),$(a(we,{onDelete:oe,tagetId:Y.itemId},null,8,["tagetId"]),[[V,A.value]])])):ye("",!0)]),_:1},8,["data-source"]),[[V,i.value]])])):(m(),_("div",Fe,[a(qe,{labName:I(s)},null,8,["labName"])]))}}},Ye=Q(Me,[["__scopeId","data-v-e0887ff5"]]);export{Ye as default};
