import{_ as W,g as r,o as X,h as m,b as p,c as I,i as a,j as l,d as S,w as F,k as D,s as v,F as M,l as $,q as Z,r as H,t as O,m as y,u as he,z as B,A as be,B as Ne,p as ye,f as Ie,x as V}from"./index-76596410.js";import{g as ee}from"./Instance-e9cab15d.js";import{D as Q,O as xe,d as we}from"./exportToExcel-95418874.js";const Ue={style:{display:"block",width:"100px","margin-left":"auto","margin-bottom":"10px"}},ke={key:0,class:"list-content"},Se=["onClick"],Ce={key:1},Le={__name:"ItemCheck",setup(E){let i;const R=r(!1);r(!1);const x=r(""),w=r(!1),u=ee(),C=r([]);X(()=>{u.whoami().then(U=>{U.data.code===1&&(i=U.data.data,R.value=i.roleId)}),u.getYearList().then(U=>{C.value=U.data.data})});const L=()=>{w.value=!0},Y=()=>{u.addYear({year:x.value}).then(U=>{U.data.code===1?(y.info(U.data.data),u.getYearList().then(h=>{C.value=h.data.data})):y.info(U.data.msg)}),x.value="",w.value=!1},c=()=>{x.value="",w.value=!1};return(U,h)=>{const b=m("a-input"),N=m("a-modal"),s=m("a-button"),z=m("a-empty");return p(),I(M,null,[a(N,{open:w.value,"onUpdate:open":h[1]||(h[1]=k=>w.value=k),"ok-text":"确定","cancel-text":"取消",onOk:Y,onCancel:c,title:"添加审查"},{default:l(()=>[a(b,{id:"year",value:x.value,"onUpdate:value":h[0]||(h[0]=k=>x.value=k),placeHolder:"请输入"},null,8,["value"])]),_:1},8,["open"]),S("div",null,[F(S("div",Ue,[a(s,{type:"primary",onClick:L},{default:l(()=>[v("添加")]),_:1})],512),[[D,R.value]]),C.value.length?(p(),I("div",ke,[(p(!0),I(M,null,$(C.value,k=>(p(),I("div",{class:"list-button",onClick:()=>{Z(H).push(`/home/item?year=${k}`)},key:k.id},O(k+"审查"),9,Se))),128))])):(p(),I("div",Ce,[a(z,{description:"请添加"})]))])],64)}}},Ae=W(Le,[["__scopeId","data-v-0873ea83"]]);const qe=E=>(ye("data-v-d9520f37"),E=E(),Ie(),E),Oe={key:0},Me={style:{display:"flex","justify-content":"space-between",padding:"0 10px"}},Ee=qe(()=>S("span",{style:{color:"#707070"}},"返回",-1)),Re={style:{color:"#707070","font-weight":"bold"}},Te={class:"loading"},Be={key:0},Fe=["onClick"],De={key:1},$e={__name:"Item",setup(E){const i=ee();let R;const x=r([]),w=r([]),u=r({}),C=r(!1),L=r(!1),Y=he(),c=B(()=>Y.query.year),U=async()=>{u.value={},L.value=!0},h=r(),b=r([]),N=r([]),s=r(!1),z=()=>{h.value.validateFields().then(n=>{s.value=!1,i.addItem(u.value).then(e=>{e.data.code===1?(y.info(e.data.data),i.getItemList(c.value,null).then(o=>{b.value=o.data.data,N.value=o.data.data,s.value=!0})):(y.info(e.data.msg),s.value=!0)}),L.value=!1}).catch(n=>{console.log("Validate Failed:",n)})},k=()=>{h.value.resetFields(),L.value=!1},T=r(!1),ae=async n=>{if(u.value=JSON.parse(JSON.stringify(n)),x===void 0||w===void 0){const e=await i.getAllUserList(),o=await i.getAllLabList();x.value=e.data.data,w.value=o.data.data}T.value=!0},te=()=>{h.value.validateFields().then(n=>{s.value=!1,i.editItem(u.value).then(e=>{e.data.code===1?(y.info(e.data.data),i.getItemList(c.value,null).then(o=>{b.value=o.data.data,N.value=o.data.data,s.value=!0})):(y.info(e.data.msg),s.value=!0)}),T.value=!1}).catch(n=>{console.log("Validate Failed:",n)})},le=()=>{h.value.resetFields(),T.value=!1},ue=n=>{s.value=!1,i.deleteItemById(n).then(e=>{e.data.code===1?(y.info(e.data.data),i.getItemList(c.value,null).then(o=>{b.value=o.data.data,N.value=o.data.data,s.value=!0})):y.info(e.data.msg)})},ne=n=>{s.value=!1,i.importExcel(n,c.value).then(e=>{e.data.code===1?(y.info(e.data.data),i.getItemList(c.value,null).then(o=>{b.value=o.data.data,N.value=o.data.data,s.value=!0})):(y.info(e.data.msg),s.value=!0)})},oe=n=>{i.deleteYearByName(n).then(e=>{e.data.code===1?(y.info(e.data.data),H.push("/home/item")):y.info(e.data.msg)})};X(()=>{i.whoami().then(n=>{n.data.code===1&&(R=n.data.data,C.value=R.roleId)}),i.getAllUserList().then(n=>{n.data.code===1&&(x.value=n.data.data)}),i.getAllLabList().then(n=>{n.data.code===1&&(w.value=n.data.data)}),c.value&&i.getItemList(c.value,null).then(n=>{b.value=n.data.data,N.value=n.data.data,s.value=!0})}),be(c,(n,e)=>{n&&(s.value=!1,i.getItemList(n,null).then(o=>{b.value=o.data.data,N.value=o.data.data,s.value=!0}))});const de=()=>{we("/item",N.value,"资产表.xlsx")},se=B(()=>new Set(b.value.map(n=>n.itemName))),ie=B(()=>{let n=[];return se.value.forEach(e=>{n.push({value:e})}),n}),ve=B(()=>new Set(b.value.map(n=>n.userName))),re=B(()=>{let n=[];return ve.value.forEach(e=>{n.push({value:e})}),n}),A=r([]),q=r([]),me=n=>{s.value=!1,N.value=b.value.filter(e=>{A.value=n.itemSelected,q.value=n.userSelected;const o=A.value.length===0||A.value.some(d=>e.itemName.includes(d)),f=q.value.length===0||q.value.some(d=>e.userName.includes(d));return o&&f}),s.value=!0},pe=(n,e,o)=>{e.itemUnit?N.value=b.value.filter(f=>{const d=A.value.length===0||A.value.some(g=>f.itemName.includes(g)),_=q.value.length===0||q.value.some(g=>f.userName.includes(g));return e.itemUnit.some(g=>f.itemUnit.includes(g))&&d&&_}):N.value=b.value.filter(f=>{const d=A.value.length===0||A.value.some(g=>f.itemName.includes(g)),_=q.value.length===0||q.value.some(g=>f.userName.includes(g));return d&&_})},fe=[{title:"类型",dataIndex:"itemType",width:"10%"},{title:"编号",dataIndex:"itemNumber",width:"10%"},{title:"名称",dataIndex:"itemName",width:"15%"},{title:"型号",dataIndex:"itemModel",width:"10%"},{title:"价值",dataIndex:"itemPrice",width:"10%"},{title:"领用人",dataIndex:"userName",width:"10%"},{title:"领用单位",dataIndex:"itemUnit",width:"8%",filters:[{text:"实验中心",value:"实验中心"},{text:"教学基地",value:"教学基地"}]},{title:"存放实验室",dataIndex:"labName",width:"10%"},{title:"状态",dataIndex:"itemStatus",width:"5%"},{title:"操作",dataIndex:"operation"}];return(n,e)=>{const o=m("a-radio-button"),f=m("a-radio-group"),d=m("a-form-item"),_=m("a-input"),g=m("a-select-option"),P=m("a-select"),j=m("a-textarea"),J=m("a-form"),G=m("a-modal"),ce=m("LeftOutlined"),_e=m("a-spin"),ge=m("a-table");return c.value?(p(),I("div",Oe,[a(G,{open:L.value,"onUpdate:open":e[11]||(e[11]=t=>L.value=t),"ok-text":"确定","cancel-text":"取消",onOk:z,onCancel:k,title:"添加"},{default:l(()=>[a(J,{ref_key:"formRef",ref:h,model:u.value,labelCol:{span:6},wrapperCol:{span:14}},{default:l(()=>[a(d,{name:"itemType",label:"资产类型",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemType,"onUpdate:value":e[0]||(e[0]=t=>u.value.itemType=t)},{default:l(()=>[a(o,{value:"仪器设备"},{default:l(()=>[v("仪器设备")]),_:1}),a(o,{value:"低值设备"},{default:l(()=>[v("低值设备")]),_:1}),a(o,{value:"家具"},{default:l(()=>[v("家具")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"资产编号"},{default:l(()=>[a(_,{value:u.value.itemNumber,"onUpdate:value":e[1]||(e[1]=t=>u.value.itemNumber=t),placeholder:"请输入资产编号"},null,8,["value"])]),_:1}),a(d,{name:"itemName",label:"资产名称",rules:[{required:!0,message:"请输入资产名称"}]},{default:l(()=>[a(_,{value:u.value.itemName,"onUpdate:value":e[2]||(e[2]=t=>u.value.itemName=t),placeholder:"请输入资产名称"},null,8,["value"])]),_:1}),a(d,{label:"型号"},{default:l(()=>[a(_,{value:u.value.itemModel,"onUpdate:value":e[3]||(e[3]=t=>u.value.itemModel=t),placeholder:"请输入型号"},null,8,["value"])]),_:1}),a(d,{name:"itemPrice",label:"价值",rules:[{required:!0,message:"请输入价值"}]},{default:l(()=>[a(_,{value:u.value.itemPrice,"onUpdate:value":e[4]||(e[4]=t=>u.value.itemPrice=t),placeholder:"请输入价值"},null,8,["value"])]),_:1}),a(d,{label:"净值"},{default:l(()=>[a(_,{value:u.value.itemNetworth,"onUpdate:value":e[5]||(e[5]=t=>u.value.itemNetworth=t),placeholder:"请输入净值"},null,8,["value"])]),_:1}),a(d,{name:"userName",label:"领用人",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(P,{value:u.value.userName,"onUpdate:value":e[6]||(e[6]=t=>u.value.userName=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,$(x.value,t=>(p(),V(g,{value:t.userName},{default:l(()=>[v(O(t.userName),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(d,{name:"itemUnit",label:"领用单位",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemUnit,"onUpdate:value":e[7]||(e[7]=t=>u.value.itemUnit=t)},{default:l(()=>[a(o,{value:"教育基地"},{default:l(()=>[v("教育基地")]),_:1}),a(o,{value:"实验中心"},{default:l(()=>[v("实验中心")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"实验室"},{default:l(()=>[a(P,{value:u.value.labName,"onUpdate:value":e[8]||(e[8]=t=>u.value.labName=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,$(w.value,t=>(p(),V(g,{value:t},{default:l(()=>[v(O(t),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(d,{name:"itemStatus",label:"状态",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemStatus,"onUpdate:value":e[9]||(e[9]=t=>u.value.itemStatus=t)},{default:l(()=>[a(o,{value:"在用"},{default:l(()=>[v("在用")]),_:1}),a(o,{value:"停用"},{default:l(()=>[v("停用")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"备注"},{default:l(()=>[a(j,{value:u.value.itemNote,"onUpdate:value":e[10]||(e[10]=t=>u.value.itemNote=t),placeholder:"备注","auto-size":{minRows:1,maxRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),a(G,{open:T.value,"onUpdate:open":e[23]||(e[23]=t=>T.value=t),"ok-text":"确定","cancel-text":"取消",onOk:te,onCancel:le,title:"编辑"},{default:l(()=>[a(J,{ref_key:"formRef",ref:h,model:u.value,labelCol:{span:6},wrapperCol:{span:14}},{default:l(()=>[a(d,{name:"itemType",label:"资产类型",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemType,"onUpdate:value":e[12]||(e[12]=t=>u.value.itemType=t)},{default:l(()=>[a(o,{value:"仪器设备"},{default:l(()=>[v("仪器设备")]),_:1}),a(o,{value:"低值设备"},{default:l(()=>[v("低值设备")]),_:1}),a(o,{value:"家具"},{default:l(()=>[v("家具")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"资产编号"},{default:l(()=>[a(_,{value:u.value.itemNumber,"onUpdate:value":e[13]||(e[13]=t=>u.value.itemNumber=t),placeholder:"请输入资产编号"},null,8,["value"])]),_:1}),a(d,{name:"itemName",label:"资产名称",rules:[{required:!0,message:"请输入资产名称"}]},{default:l(()=>[a(_,{value:u.value.itemName,"onUpdate:value":e[14]||(e[14]=t=>u.value.itemName=t),placeholder:"请输入资产名称"},null,8,["value"])]),_:1}),a(d,{label:"型号"},{default:l(()=>[a(_,{value:u.value.itemModel,"onUpdate:value":e[15]||(e[15]=t=>u.value.itemModel=t),placeholder:"请输入型号"},null,8,["value"])]),_:1}),a(d,{name:"itemPrice",label:"价值",rules:[{required:!0,message:"请输入价值"}]},{default:l(()=>[a(_,{value:u.value.itemPrice,"onUpdate:value":e[16]||(e[16]=t=>u.value.itemPrice=t),placeholder:"请输入价值"},null,8,["value"])]),_:1}),a(d,{label:"净值"},{default:l(()=>[a(_,{value:u.value.itemNetworth,"onUpdate:value":e[17]||(e[17]=t=>u.value.itemNetworth=t),placeholder:"请输入净值"},null,8,["value"])]),_:1}),a(d,{name:"userName",label:"领用人",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(P,{value:u.value.userName,"onUpdate:value":e[18]||(e[18]=t=>u.value.userName=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,$(x.value,t=>(p(),V(g,{value:t.userName},{default:l(()=>[v(O(t.userName),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(d,{name:"itemUnit",label:"领用单位",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemUnit,"onUpdate:value":e[19]||(e[19]=t=>u.value.itemUnit=t)},{default:l(()=>[a(o,{value:"教学基地"},{default:l(()=>[v("教学基地")]),_:1}),a(o,{value:"实验中心"},{default:l(()=>[v("实验中心")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"实验室"},{default:l(()=>[a(P,{value:u.value.labName,"onUpdate:value":e[20]||(e[20]=t=>u.value.labName=t),placeholder:"请选择"},{default:l(()=>[(p(!0),I(M,null,$(w.value,t=>(p(),V(g,{value:t},{default:l(()=>[v(O(t),1)]),_:2},1032,["value"]))),256))]),_:1},8,["value"])]),_:1}),a(d,{name:"itemStatus",label:"状态",rules:[{required:!0,message:"请选择"}]},{default:l(()=>[a(f,{value:u.value.itemStatus,"onUpdate:value":e[21]||(e[21]=t=>u.value.itemStatus=t)},{default:l(()=>[a(o,{value:"在用"},{default:l(()=>[v("在用")]),_:1}),a(o,{value:"停用"},{default:l(()=>[v("停用")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"备注"},{default:l(()=>[a(j,{value:u.value.itemNote,"onUpdate:value":e[22]||(e[22]=t=>u.value.itemNote=t),placeholder:"备注","auto-size":{minRows:1,maxRows:3}},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),S("div",Me,[S("div",{style:{cursor:"pointer"},onClick:e[24]||(e[24]=()=>{Z(H).back()})},[a(ce,{style:{padding:"0 5px 15px 0","font-size":"15px",color:"#707070"}}),Ee]),S("div",null,[S("span",Re,O(c.value+"年审查"),1),F(a(Q,{onDelete:oe,tagetId:c.value},null,8,["tagetId"]),[[D,c.value]])])]),a(xe,{addShow:C.value,itemList:ie.value,userList:re.value,onAdd:U,onExport:de,onHandleSearch:me,onHandleImport:ne},null,8,["addShow","itemList","userList"]),F(S("div",Te,[a(_e,{size:"large"})],512),[[D,!s.value]]),F(a(ge,{columns:fe,"data-source":N.value,onChange:pe,"row-key":"itemId",bordered:""},{bodyCell:l(({column:t,record:K})=>[t.dataIndex==="operation"?(p(),I("span",Be,[S("a",{onClick:Pe=>ae(K)},"编辑",8,Fe),F(a(Q,{onDelete:ue,tagetId:K.itemId},null,8,["tagetId"]),[[D,C.value]])])):Ne("",!0)]),_:1},8,["data-source"]),[[D,s.value]])])):(p(),I("div",De,[a(Ae)]))}}},He=W($e,[["__scopeId","data-v-d9520f37"]]);export{He as default};
