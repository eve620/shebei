import{_ as le,g as c,u as oe,o as ne,z as x,h as i,b,c as C,i as l,j as u,w as A,k as y,d as I,F as E,m as h,l as F,q as O,B as ue,r as se,x as R,s as V,t as q}from"./index-76596410.js";import{g as de}from"./Instance-e9cab15d.js";import{O as re,d as ce,D as ie}from"./exportToExcel-95418874.js";import{e as ve}from"./utils-8ff33db2.js";const me={class:"loading"},fe={key:0},pe=["onClick"],_e=["onClick"],be={__name:"Lab",setup(he){const d=de();let U,f;const o=c({}),L=c(!1),g=c(!1);oe();const B=a=>{o.value.userAccount=a},$=async()=>{o.value={},f===void 0&&(f=(await d.getAllUserList()).data.data),g.value=!0},M=a=>{se.push({name:"labDetail",query:{id:ve(a)}})},p=c(),z=()=>{p.value.validateFields().then(a=>{s.value=!1,d.addLab(o.value).then(e=>{e.data.code===1?(h.info(e.data.data),d.getLabList().then(n=>{m.value=n.data.data,v.value=n.data.data,s.value=!0})):(h.info(e.data.msg),s.value=!0)}),g.value=!1}).catch(a=>{console.log("Validate Failed:",a)})},J=()=>{p.value.resetFields(),g.value=!1},N=c(!1),T=async a=>{o.value=JSON.parse(JSON.stringify(a)),f===void 0&&(f=(await d.getAllUserList()).data.data),N.value=!0},j=()=>{p.value.validateFields().then(a=>{s.value=!1,d.editLab(o.value).then(e=>{e.data.code===1?(h.info(e.data.data),d.getLabList().then(n=>{m.value=n.data.data,v.value=n.data.data,s.value=!0})):(h.info(e.data.msg),s.value=!0)}),N.value=!1}).catch(a=>{console.log("Validate Failed:",a)})},H=()=>{p.value.resetFields(),N.value=!1},G=a=>{s.value=!1,d.deleteLabById(a).then(e=>{e.data.code===1?(h.info(e.data.data),d.getLabList().then(n=>{m.value=n.data.data,v.value=n.data.data,s.value=!0})):h.info(e.data.msg)})};ne(()=>{d.whoami().then(a=>{a.data.code===1&&(U=a.data.data,L.value=U.roleId)}),d.getLabList().then(a=>{m.value=a.data.data,v.value=a.data.data,s.value=!0})});const K=()=>{ce("/lab",v.value,"实验室表.xlsx")},v=c(),m=c([]),s=c(!1),Q=x(()=>new Set(m.value.map(a=>a.labName))),W=x(()=>{let a=[];return Q.value.forEach(e=>{a.push({value:e})}),a}),X=x(()=>new Set(m.value.map(a=>a.userName))),Y=x(()=>{let a=[];return X.value.forEach(e=>{a.push({value:e})}),a}),Z=a=>{s.value=!1,v.value=m.value.filter(e=>{const n=a.itemSelected,r=a.userSelected,w=n.length===0||n.some(_=>e.labName.includes(_)),S=r.length===0||r.some(_=>e.userName.includes(_));return w&&S}),s.value=!0},P=[{title:"实验室名称",dataIndex:"labName",width:"15%"},{title:"管理员名称",dataIndex:"userName",width:"15%"},{title:"管理员工资号",dataIndex:"userAccount",width:"40%"},{title:"操作",dataIndex:"operation"}];return(a,e)=>{const n=i("a-input"),r=i("a-form-item"),w=i("a-select-option"),S=i("a-select"),_=i("a-form"),D=i("a-modal"),ee=i("a-spin"),ae=i("a-table");return b(),C(E,null,[l(D,{open:g.value,"onUpdate:open":e[3]||(e[3]=t=>g.value=t),"ok-text":"确定","cancel-text":"取消",onOk:z,onCancel:J,title:"添加"},{default:u(()=>[l(_,{ref_key:"formRef",ref:p,model:o.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[l(r,{name:"labName",label:"地点",rules:[{required:!0,message:"请输入地点"}]},{default:u(()=>[l(n,{value:o.value.labName,"onUpdate:value":e[0]||(e[0]=t=>o.value.labName=t),placeholder:"请输入地点"},null,8,["value"])]),_:1}),l(r,{name:"userName",label:"管理人",rules:[{required:!0,message:"请选择管理人"}]},{default:u(()=>[l(S,{value:o.value.userName,"onUpdate:value":e[1]||(e[1]=t=>o.value.userName=t),placeholder:"请选择"},{default:u(()=>[(b(!0),C(E,null,F(O(f),t=>(b(),R(w,{value:t.userName,onClick:k=>B(t.userAccount)},{default:u(()=>[V(q(t.userName),1)]),_:2},1032,["value","onClick"]))),256))]),_:1},8,["value"])]),_:1}),l(r,{label:"工资号"},{default:u(()=>[l(n,{value:o.value.userAccount,"onUpdate:value":e[2]||(e[2]=t=>o.value.userAccount=t),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),l(D,{open:N.value,"onUpdate:open":e[7]||(e[7]=t=>N.value=t),"ok-text":"确定","cancel-text":"取消",onOk:j,onCancel:H,title:"编辑"},{default:u(()=>[l(_,{ref_key:"formRef",ref:p,model:o.value,labelCol:{span:6},wrapperCol:{span:14}},{default:u(()=>[l(r,{label:"地点"},{default:u(()=>[l(n,{value:o.value.labName,"onUpdate:value":e[4]||(e[4]=t=>o.value.labName=t),disabled:!0},null,8,["value"])]),_:1}),l(r,{label:"管理人"},{default:u(()=>[l(S,{value:o.value.userName,"onUpdate:value":e[5]||(e[5]=t=>o.value.userName=t),placeholder:"请选择"},{default:u(()=>[(b(!0),C(E,null,F(O(f),t=>(b(),R(w,{value:t.userName,onClick:k=>B(t.userAccount)},{default:u(()=>[V(q(t.userName),1)]),_:2},1032,["value","onClick"]))),256))]),_:1},8,["value"])]),_:1}),l(r,{label:"工资号"},{default:u(()=>[l(n,{value:o.value.userAccount,"onUpdate:value":e[6]||(e[6]=t=>o.value.userAccount=t),disabled:!0},null,8,["value"])]),_:1})]),_:1},8,["model"])]),_:1},8,["open"]),l(re,{"item-list":W.value,"user-list":Y.value,addShow:L.value,onAdd:$,onExport:K,onHandleSearch:Z},null,8,["item-list","user-list","addShow"]),A(I("div",me,[l(ee,{size:"large"})],512),[[y,!s.value]]),A(l(ae,{columns:P,"data-source":v.value,"row-key":"itemId",bordered:""},{bodyCell:u(({column:t,record:k})=>[t.dataIndex==="operation"?(b(),C("span",fe,[I("a",{onClick:te=>T(k)},"编辑",8,pe),I("a",{class:"check-button",onClick:te=>M(k.labName)},"查看",8,_e),A(l(ie,{onDelete:G,tagetId:k.labId},null,8,["tagetId"]),[[y,L.value]])])):ue("",!0)]),_:1},8,["data-source"]),[[y,s.value]])],64)}}},Se=le(be,[["__scopeId","data-v-82a742b7"]]);export{Se as default};
